# 图片编辑功能使用指南

## 📋 功能概述

新增的**图片编辑**模块基于 Google Gemini 官方推荐的多轮对话方式，支持对现有图片进行迭代式编辑。

## 🎯 核心特性

### 1. 多轮对话编辑
- **对话式交互**：像聊天一样对图片进行多次编辑
- **历史记录**：保留完整的编辑对话历史
- **迭代优化**：每次编辑都基于上一次的结果
- **实时预览**：编辑结果即时显示

### 2. 支持的编辑类型

根据 Google 官方文档，支持以下编辑操作：

#### 🎨 添加和移除元素
```
示例：
- "在图片中添加一只猫"
- "移除背景中的汽车"
- "在前景添加一朵红色的花"
```

#### 🖌 局部重绘（语义遮盖）
```
示例：
- "把天空改成日落"
- "将沙发颜色改为蓝色"
- "把T恤上的图案换成星星"
```

#### 🎭 风格迁移
```
示例：
- "将这张照片转换为梵高风格"
- "用水彩画风格重新绘制"
- "改为卡通漫画风格"
```

#### 🌍 语言/文字修改
```
示例：
- "将图片中的文字改为西班牙语"
- "把标题改成中文"
- "保持所有内容不变，只改变文字语言"
```

#### 🔧 细节调整
```
示例：
- "让光线更暖一些"
- "增加对比度"
- "让背景更模糊"
```

## 📖 使用步骤

### 第一步：上传图片

1. 点击**"选择图片"**按钮
2. 选择要编辑的图片文件（支持 PNG、JPG、JPEG、BMP、GIF）
3. 图片将显示在预览区域
4. 对话历史中显示"原始图片"

### 第二步：输入编辑指令

1. 在底部的文本框中输入您的编辑需求
2. 描述要清晰、具体
3. 可以参考上方的提示示例

### 第三步：应用编辑

1. 点击**"🎨 应用编辑"**按钮
2. 等待API处理（通常需要10-30秒）
3. 编辑后的图片自动显示在预览区
4. 对话历史中添加您的指令和编辑结果

### 第四步：继续迭代

1. 查看编辑结果
2. 如需调整，继续输入新的编辑指令
3. 每次编辑都基于当前图片
4. 可以进行多轮迭代直到满意

### 第五步：保存结果

1. 点击**"💾 保存编辑后的图片"**按钮
2. 选择保存位置和文件名
3. 编辑完成的图片将保存到本地

## 🎨 界面布局

```
┌─────────────────────────────────────────────────┐
│  📤 上传图片区域                                 │
│  [选择图片]  [开始新会话]                        │
├───────────────────┬─────────────────────────────┤
│ 💬 编辑对话历史    │  🖼 当前图片                 │
│                   │                             │
│ 👤 用户指令       │  [预览区域]                  │
│ "添加一只猫"       │                             │
│                   │                             │
│ 🤖 编辑结果       │  [💾 保存图片]               │
│ [缩略图]          │                             │
│                   │                             │
│ 👤 用户指令       │                             │
│ "改为日落场景"     │                             │
│                   │                             │
│ 🤖 编辑结果       │                             │
│ [缩略图]          │                             │
├───────────────────┴─────────────────────────────┤
│ ✍ 输入编辑指令                                   │
│ [文本框]                     [🎨 应用编辑]        │
└─────────────────────────────────────────────────┘
```

## 💡 最佳实践

### 1. 清晰的指令描述

❌ **不好的示例：**
```
"改一下"
"好看点"
"换个颜色"
```

✅ **好的示例：**
```
"把天空改成日落时分的橙红色"
"在画面右下角添加一只白色的小猫，坐在草地上"
"将背景墙的颜色从白色改为浅蓝色"
```

### 2. 分步迭代

对于复杂的编辑，建议分步进行：

```
第1步："在图片中添加一座山"
第2步："给山顶添加积雪"
第3步："在山脚下添加一个小湖"
第4步："让整体色调更暖一些"
```

### 3. 保持上下文

每次编辑都基于当前图片，无需重复之前的内容：

```
第1次："添加一棵树"
第2次："让这棵树更高一些"  ✅（系统知道指的是刚添加的树）
第2次："添加一棵更高的树"  ❌（会添加第二棵树）
```

### 4. 使用"保持不变"

如果只想修改特定部分：

```
"保持所有内容不变，只把文字改为西班牙语"
"保持构图和元素不变，只调整光线更暖一些"
```

## ⚙️ 技术要求

### API 配置

- **推荐模型**：Gemini 3 Pro Image Preview
- **最低要求**：支持图片输入的 Gemini 模型
- **不支持**：nano-banana 等纯文生图模型（会降级为文生图）

### 模型能力对比

| 模型 | 图片编辑 | 多轮对话 | 推荐度 |
|------|---------|---------|--------|
| Gemini 3 Pro Image | ✅ 完整支持 | ✅ | ⭐⭐⭐⭐⭐ |
| Gemini 2.5 Flash Image | ✅ 支持 | ✅ | ⭐⭐⭐⭐ |
| nano-banana | ❌ 不支持 | ❌ | ⚠️ |

### 图片要求

- **格式**：PNG、JPG、JPEG、BMP、GIF
- **大小**：建议小于 10MB
- **尺寸**：建议不超过 4096x4096

## 🌟 高级功能

### 1. 新会话管理

点击**"🔄 开始新会话"**可以：
- 清空当前的编辑历史
- 重新上传新图片
- 开始全新的编辑流程

### 2. 历史记录浏览

- 点击对话历史中的缩略图可查看大图
- 自动滚动到最新的对话
- 时间戳显示每次编辑的时间

### 3. 快速预览

- 编辑结果实时显示
- 支持窗口大小调整
- 自适应缩放保持比例

## 📚 官方文档示例

### 示例1：信息图编辑

```
原始图片：光合作用信息图（英文）

第1次编辑：
"Update this infographic to be in Spanish. 
Do not change any other elements of the image."

结果：所有文字改为西班牙语，图形元素保持不变
```

### 示例2：产品照片编辑

```
原始图片：咖啡杯产品照

第1次编辑：
"Add a plant in the background"

第2次编辑：
"Change the lighting to golden hour"

第3次编辑：
"Make the coffee steam more visible"
```

### 示例3：风格转换

```
原始图片：风景照片

第1次编辑：
"Transform this photograph into the artistic 
style of Van Gogh. Preserve the original 
composition but render it with impressionist 
brushstrokes and vibrant colors."
```

## 🚨 注意事项

1. **API限制**：
   - 每次编辑需要消耗API配额
   - 处理时间取决于网络和服务器负载

2. **编辑精度**：
   - 简单编辑效果更好
   - 复杂编辑可能需要多轮迭代
   - 结果可能与预期有差异

3. **数据保存**：
   - 对话历史不会自动保存
   - 切换到其他标签页会保留当前会话
   - 关闭程序会丢失未保存的图片

4. **性能优化**：
   - 图片过大会增加处理时间
   - 建议压缩后再上传
   - 历史记录过多会占用内存

## 🔧 故障排查

### 问题1：无法上传图片
```
解决方案：
- 检查文件格式是否支持
- 确认文件大小不超过限制
- 尝试转换为PNG格式
```

### 问题2：编辑失败
```
解决方案：
- 检查API配置是否正确
- 确认使用的是支持图片编辑的模型
- 查看错误信息提示
- 尝试更换API或模型
```

### 问题3：结果不理想
```
解决方案：
- 使用更清晰、具体的描述
- 分步骤进行小幅度编辑
- 尝试重新措辞指令
- 使用"保持不变"来限定修改范围
```

### 问题4：处理时间过长
```
解决方案：
- 压缩输入图片
- 检查网络连接
- 等待服务器响应（可能需要30秒-1分钟）
- 避免过于复杂的编辑指令
```

## 📊 使用技巧

### 技巧1：渐进式编辑
```
不要一次性要求太多改变，而是：
1️⃣ 先调整整体布局
2️⃣ 再添加/删除元素
3️⃣ 然后调整细节
4️⃣ 最后优化色彩和光线
```

### 技巧2：使用参考描述
```
"像电影海报一样的构图"
"参考莫奈的风格"
"类似专业产品摄影的效果"
```

### 技巧3：明确边界
```
"只修改背景，保持前景人物不变"
"改变色调但保持构图"
"增强对比度但不改变颜色"
```

### 技巧4：验证结果
```
每次编辑后：
✓ 检查是否达到预期
✓ 如需调整，立即进行下一轮
✓ 满意后保存，然后继续下一个编辑
```

## 🎓 学习资源

- [Google Gemini 图片编辑官方文档](https://ai.google.dev/gemini-api/docs/image-generation?hl=zh-cn#image-editing)
- [多轮图片修改示例](https://ai.google.dev/gemini-api/docs/image-generation?hl=zh-cn#multi-turn-image-modification)
- [图片编辑最佳实践](https://ai.google.dev/gemini-api/docs/image-generation?hl=zh-cn#prompting-for-image-editing)

---

**提示**：图片编辑功能需要使用支持图片输入的 Gemini 模型。推荐使用 Gemini 3 Pro Image Preview 以获得最佳编辑效果！
