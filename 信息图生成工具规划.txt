信息图生成工具

本方案聚焦提示词结构化生成与Gemini API 调用，采用模块化设计，无需文档编辑器，完全通过代码实现 “选风格→选比例→输内容→生成提示词→生成信息图” 的流程。
一、方案核心目标
 8 大风格分类和比例选择功能，降低用户输入成本；
自动生成标准化提示词，避免手动编写复杂指令；
封装 Gemini API 调用逻辑，一键生成并保存信息图；
支持系统设置（API 密钥、默认参数），兼顾新手友好性与扩展性。
二、技术栈选型
核心语言：Python 3.8+
依赖库：
google-generativeai：调用 Gemini API 生成图片；
tkinter：内置库，实现简易 GUI（无需额外安装）；
json：管理配置文件；
os/datetime：文件路径与时间戳处理。
三、整体架构设计
工具采用模块化低耦合设计，分为 5 个核心模块，各模块职责清晰：
plaintext
Python 信息图生成工具
├── config/                # 配置模块：管理 API 密钥、预设参数
│   └── config.json        # 配置文件（风格、比例、默认路径等）
├── core/                  # 核心业务模块
│   ├── config_manager.py  # 配置读取与更新
│   ├── prompt_generator.py # 提示词自动生成（核心）
│   └── image_generator.py  # 调用 Gemini API 生成图片
├── interface/             # 交互模块
│   ├── cli.py             # 命令行交互（新手入门）
│   └── gui.py             # 图形界面交互（可视化操作）
└── main.py                # 程序入口：启动 CLI/GUI
四、各模块详细设计
1. 配置模块（config + config_manager.py）
（1）配置文件（config.json）
存储 API 密钥、预设风格、比例等参数，无需硬编码，方便用户修改：
json
{
  "gemini_api_key": "YOUR_GEMINI_API_KEY",
  "default_model": "gemini-2.5-flash",
  "save_path": "./output/infographics",
  "language": "zh-CN",
  "style_categories": {
    "A 3D拟真与维度": "立体感强、真实感高的3D风格，突出空间层次和实体质感，适合产品展示、数据可视化",
    "B 极简与扁平": "简洁明了、现代感强的扁平化设计，无多余装饰，色彩纯净，适合流程说明、基础信息图",
    "C 科技与赛博": "未来感、科技感的数字化风格，含霓虹光效、代码元素、金属质感，适合科技产品、技术原理",
    "D 复古与怀旧": "经典复古、怀旧情怀的设计风格，采用复古色调、纹理，适合历史主题、怀旧内容",
    "E 艺术与有机": "艺术化、自然有机的创意风格，融入自然元素、手绘质感，适合科普、文化主题",
    "F 电影级视觉": "电影质感、戏剧化的视觉效果，高对比度、电影色调，适合重点突出、氛围营造",
    "G 材质与纹理": "强调材质质感和纹理细节，如纸张、木纹、金属纹理，适合产品细节、材质展示",
    "H 抽象与概念": "抽象化、概念化的艺术表达，用几何图形、色彩块传递核心概念，适合哲学、创意主题"
  },
  "ratio_presets": {
    "1:1": "正方形（适合社交媒体、海报）",
    "4:3": "标准比例（适合文档、演示文稿）",
    "16:9": "宽屏比例（适合视频封面、大屏展示）",
    "3:4": "竖屏比例（适合手机端、短视频封面）"
  },
  "ratio_to_resolution": {
    "1:1": "1024x1024",
    "4:3": "1280x960",
    "16:9": "1920x1080",
    "3:4": "960x1280"
  }
}
（2）配置管理代码（core/config_manager.py）
负责配置的加载、保存与更新，避免敏感信息硬编码：
python
运行
import json
import os

class ConfigManager:
    def __init__(self, config_path="./config/config.json"):
        self.config_path = config_path
        self.config = self._load_config()

    def _load_config(self):
        """加载配置文件，不存在则生成默认配置"""
        os.makedirs(os.path.dirname(self.config_path), exist_ok=True)
        if not os.path.exists(self.config_path):
            default_config = self._get_default_config()
            self._save_config(default_config)
            return default_config
        with open(self.config_path, "r", encoding="utf-8") as f:
            return json.load(f)

    def _get_default_config(self):
        """默认配置模板，与 config.json 结构一致"""
        return {
            "gemini_api_key": "",
            "default_model": "gemini-2.5-flash",
            "save_path": "./output/infographics",
            "language": "zh-CN",
            "style_categories": {},
            "ratio_presets": {},
            "ratio_to_resolution": {}
        }

    def _save_config(self, config_dict):
        """保存配置到 JSON 文件"""
        with open(self.config_path, "w", encoding="utf-8") as f:
            json.dump(config_dict, f, ensure_ascii=False, indent=4)

    def get(self, key, default=None):
        """获取配置项"""
        return self.config.get(key, default)

    def update(self, key, value):
        """更新单个配置项（如 API 密钥）"""
        self.config[key] = value
        self._save_config(self.config)

    def get_style_categories(self):
        """获取风格分类字典"""
        return self.get("style_categories", {})

    def get_ratio_presets(self):
        """获取比例预设字典"""
        return self.get("ratio_presets", {})

    def get_resolution_by_ratio(self, ratio):
        """根据比例获取对应分辨率"""
        return self.get("ratio_to_resolution", {}).get(ratio, "1024x768")
2. 核心业务模块
（1）提示词生成模块（core/prompt_generator.py）
对齐参考网页四步流程，自动生成结构化提示词，融入风格描述提升精准度：
python
运行
class PromptGenerator:
    def __init__(self, config_manager):
        self.config = config_manager
        self.base_template = (
            "生成一张{style_name}风格的信息图，风格特点：{style_desc}。"
            "比例：{ratio}，分辨率：{resolution}，语言：{language}。"
            "核心内容：{content}。"
            "设计要求：符合所选风格的视觉特征，布局清晰，重点突出，配色协调，适合{usage_scene}使用。"
            "输出格式：高清 PNG 图片，无水印，无多余文字。"
        )

    def generate(self, style_key, ratio, content, usage_scene="通用场景"):
        """
        生成标准化提示词
        :param style_key: 选中的风格键（如"A 3D拟真与维度"）
        :param ratio: 选中的比例（如"16:9"）
        :param content: 核心内容描述
        :param usage_scene: 使用场景
        :return: 结构化提示词
        """
        # 获取风格名称和描述
        style_dict = self.config.get_style_categories()
        if style_key not in style_dict:
            raise ValueError(f"无效风格：{style_key}，可选风格：{list(style_dict.keys())}")
        style_name = style_key.split(" ")[1]
        style_desc = style_dict[style_key]

        # 获取分辨率
        resolution = self.config.get_resolution_by_ratio(ratio)
        language = self.config.get("language", "zh-CN")

        # 填充模板
        prompt = self.base_template.format(
            style_name=style_name,
            style_desc=style_desc,
            ratio=ratio,
            resolution=resolution,
            language=language,
            content=content,
            usage_scene=usage_scene
        )
        return prompt.strip()

    def custom_prompt(self, custom_text):
        """支持用户自定义提示词"""
        return custom_text.strip()
（2）图片生成模块（core/image_generator.py）
封装 Gemini API 调用逻辑，负责生成图片并保存到指定路径：
python
运行
import google.generativeai as genai
import os
from datetime import datetime

class ImageGenerator:
    def __init__(self, config_manager):
        self.config = config_manager
        self._init_gemini()

    def _init_gemini(self):
        """初始化 Gemini 客户端"""
        api_key = self.config.get("gemini_api_key")
        if not api_key:
            raise RuntimeError("未配置 Gemini API 密钥，请在 config.json 中填写")
        genai.configure(api_key=api_key)
        self.model = genai.GenerativeModel(self.config.get("default_model", "gemini-2.5-flash"))

    def generate(self, prompt, save_name=None):
        """
        调用 API 生成图片并保存
        :param prompt: 提示词
        :param save_name: 自定义文件名，默认自动生成
        :return: 图片保存路径
        """
        # 生成图片
        try:
            response = self.model.generate_content(
                prompt,
                generation_config={
                    "response_mime_type": "image/png",
                }
            )
            response.resolve()
        except Exception as e:
            raise RuntimeError(f"API 调用失败：{str(e)}")

        # 处理保存路径
        save_path = self.config.get("save_path", "./output/infographics")
        os.makedirs(save_path, exist_ok=True)
        if not save_name:
            timestamp = datetime.now().strftime("%Y%m%d_%H%M%S")
            save_name = f"infographic_{timestamp}.png"
        full_path = os.path.join(save_path, save_name)

        # 保存图片
        with open(full_path, "wb") as f:
            f.write(response.image_bytes)
        return full_path
3. 交互模块
（1）命令行交互（interface/cli.py）
适合开发者快速使用，四步引导式操作，对齐参考网页流程：
python
运行
from core.config_manager import ConfigManager
from core.prompt_generator import PromptGenerator
from core.image_generator import ImageGenerator

def cli_main():
    # 初始化模块
    config = ConfigManager()
    prompt_gen = PromptGenerator(config)
    image_gen = ImageGenerator(config)

    print("===== Python 信息图生成工具（CLI 版）=====")
    print("核心流程：选择风格 → 选择比例 → 输入内容 → 生成图片\n")

    # 1. 系统设置（可选）
    if input("是否修改系统设置？(y/n)：").lower() == "y":
        new_api_key = input(f"输入 Gemini API 密钥（当前：{config.get('gemini_api_key')[:8] if config.get('gemini_api_key') else '空'}）：")
        if new_api_key:
            config.update("gemini_api_key", new_api_key)
        print("设置保存成功！\n")

    # 2. 选择风格
    print("----- 第一步：选择风格 -----")
    styles = config.get_style_categories()
    style_list = list(styles.keys())
    for idx, style in enumerate(style_list, 1):
        desc = styles[style][:30] + "..." if len(styles[style]) > 30 else styles[style]
        print(f"{idx}. {style}：{desc}")
    style_idx = int(input(f"\n请输入风格序号（1-{len(style_list)}）：")) - 1
    selected_style = style_list[style_idx]
    print(f"已选择：{selected_style}\n")

    # 3. 选择比例
    print("----- 第二步：选择比例 -----")
    ratios = config.get_ratio_presets()
    ratio_list = list(ratios.keys())
    for idx, ratio in enumerate(ratio_list, 1):
        print(f"{idx}. {ratio}：{ratios[ratio]}")
    ratio_idx = int(input(f"\n请输入比例序号（1-{len(ratio_list)}）：")) - 1
    selected_ratio = ratio_list[ratio_idx]
    print(f"已选择：{selected_ratio}\n")

    # 4. 输入内容
    print("----- 第三步：输入内容 -----")
    content = input("请输入信息图核心内容：")
    usage_scene = input("请输入使用场景（可选）：") or "通用场景"
    print()

    # 5. 生成图片
    print("----- 第四步：生成图片 -----")
    try:
        prompt = prompt_gen.generate(selected_style, selected_ratio, content, usage_scene)
        print(f"生成的提示词：\n{prompt}\n")
        if input("是否确认生成？(y/n)：").lower() == "y":
            save_path = image_gen.generate(prompt)
            print(f"\n✅ 生成成功！图片路径：{save_path}")
    except Exception as e:
        print(f"\n❌ 生成失败：{str(e)}")

if __name__ == "__main__":
    cli_main()
（2）图形界面交互（interface/gui.py）
基于 Tkinter 实现可视化操作，完全还原参考网页的选择逻辑，适合非技术用户：
python
运行
import tkinter as tk
from tkinter import ttk, messagebox
from core.config_manager import ConfigManager
from core.prompt_generator import PromptGenerator
from core.image_generator import ImageGenerator

class InfographicGUI:
    def __init__(self, root):
        self.root = root
        self.root.title("信息图生成工具（GUI 版）")
        self.root.geometry("650x550")

        # 初始化模块
        self.config = ConfigManager()
        self.prompt_gen = PromptGenerator(self.config)
        self.image_gen = ImageGenerator(self.config)

        # 界面组件
        self._init_widgets()

    def _init_widgets(self):
        # 标题
        title_label = ttk.Label(self.root, text="信息图生成四步法", font=("微软雅黑", 18, "bold"))
        title_label.pack(pady=15)

        # 风格选择区域
        self._create_style_frame()

        # 比例选择区域
        self._create_ratio_frame()

        # 内容输入区域
        self._create_content_frame()

        # 生成按钮
        generate_btn = ttk.Button(self.root, text="生成信息图", command=self._generate, width=20)
        generate_btn.pack(pady=20)

    def _create_style_frame(self):
        frame = ttk.LabelFrame(self.root, text="第一步：选择风格", padding=10)
        frame.pack(fill=tk.X, padx=20, pady=5)

        # 风格下拉框
        self.style_var = tk.StringVar()
        styles = list(self.config.get_style_categories().keys())
        self.style_combobox = ttk.Combobox(frame, textvariable=self.style_var, values=styles, state="readonly", width=50)
        self.style_combobox.pack()
        if styles:
            self.style_combobox.current(0)
            self._update_style_desc()

        # 风格描述标签
        self.style_desc_label = ttk.Label(frame, text="", wraplength=580, foreground="#666")
        self.style_desc_label.pack(pady=5)

        # 绑定风格选择事件
        self.style_combobox.bind("<<ComboboxSelected>>", lambda e: self._update_style_desc())

    def _update_style_desc(self):
        """更新风格描述"""
        style_key = self.style_var.get()
        desc = self.config.get_style_categories().get(style_key, "")
        self.style_desc_label.config(text=f"风格描述：{desc}")

    def _create_ratio_frame(self):
        frame = ttk.LabelFrame(self.root, text="第二步：选择比例", padding=10)
        frame.pack(fill=tk.X, padx=20, pady=5)

        self.ratio_var = tk.StringVar()
        ratios = list(self.config.get_ratio_presets().keys())
        self.ratio_combobox = ttk.Combobox(frame, textvariable=self.ratio_var, values=ratios, state="readonly", width=50)
        self.ratio_combobox.pack()
        if ratios:
            self.ratio_combobox.current(2)  # 默认选中16:9

    def _create_content_frame(self):
        frame = ttk.LabelFrame(self.root, text="第三步：输入内容", padding=10)
        frame.pack(fill=tk.BOTH, expand=True, padx=20, pady=5)

        # 核心内容输入框
        ttk.Label(frame, text="核心内容：").pack(anchor=tk.W)
        self.content_text = tk.Text(frame, height=5, width=70)
        self.content_text.pack(fill=tk.X, pady=5)
        self.content_text.insert(tk.END, "示例：2026年法定节假日安排、T细胞激活机制科普")

        # 使用场景输入框
        ttk.Label(frame, text="使用场景（可选）：").pack(anchor=tk.W)
        self.scene_entry = ttk.Entry(frame, width=70)
        self.scene_entry.pack(fill=tk.X, pady=5)
        self.scene_entry.insert(tk.END, "公众号文章、论文插图、PPT演示")

    def _generate(self):
        """生成图片逻辑"""
        # 获取用户输入
        style_key = self.style_var.get()
        ratio = self.ratio_var.get()
        content = self.content_text.get("1.0", tk.END).strip()
        usage_scene = self.scene_entry.get().strip() or "通用场景"

        # 校验输入
        if not content:
            messagebox.showerror("错误", "请输入核心内容！")
            return

        try:
            # 生成提示词和图片
            prompt = self.prompt_gen.generate(style_key, ratio, content, usage_scene)
            save_path = self.image_gen.generate(prompt)
            messagebox.showinfo("成功", f"图片生成完成！\n路径：{save_path}")
        except Exception as e:
            messagebox.showerror("失败", f"生成出错：{str(e)}")

def gui_main():
    root = tk.Tk()
    app = InfographicGUI(root)
    root.mainloop()

if __name__ == "__main__":
    gui_main()
4. 程序入口（main.py）
统一启动入口，支持选择 CLI/GUI 模式：
python
运行
from interface.cli import cli_main
from interface.gui import gui_main

if __name__ == "__main__":
    print("===== 信息图生成工具 =====")
    print("请选择运行模式：")
    print("1. CLI 命令行模式（适合开发者）")
    print("2. GUI 图形界面模式（适合普通用户）")
    choice = input("输入模式序号（1/2）：")
    if choice == "1":
        cli_main()
    elif choice == "2":
        gui_main()
    else:
        print("无效选择，默认启动 CLI 模式")
        cli_main()
五、部署与使用步骤
环境准备
bash
运行
# 安装依赖
pip install google-generativeai
配置 API 密钥
前往 Google AI Studio 获取 Gemini API 密钥；
运行工具后选择 “修改系统设置”，输入密钥，或直接编辑 config/config.json。
运行工具
bash
运行
python main.py
选择 CLI/GUI 模式，按提示完成风格、比例选择和内容输入，即可生成信息图。
六、扩展优化建议
风格预览功能：为每个风格添加示例图，在 GUI 中选择风格时实时展示；
批量生成：支持导入 Excel/CSV 文件，批量生成多组内容的信息图；
自定义模板：允许用户保存自定义提示词模板，新增风格分类；
错误重试机制：API 调用失败时自动重试，提升稳定性；
格式扩展：支持生成 JPG/WEBP 格式，适配不同场景需求。